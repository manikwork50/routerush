<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Hidden Gems | WanderMap</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('img/nature-about-bg.jpg') no-repeat center center/cover;
      padding: 20px;
      color: #222;
    }

    .admin-container {
      max-width: 900px;
      margin: 40px auto;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
    }

    #filterState {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .gem {
      border-bottom: 1px solid #ccc;
      padding: 15px 0;
    }

    .gem h3 {
      margin: 0;
    }

    .gem p {
      margin: 5px 0;
    }

    .gem small {
      color: #555;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>üìã Submitted Hidden Gems</h1>
    <input type="text" id="filterState" placeholder="Filter by state (e.g. Kerala)" />

    <div id="gemsList">
      ‚è≥ Loading hidden gems...
    </div>
  </div>

  <script>
    const gemsList = document.getElementById('gemsList');
    const filterInput = document.getElementById('filterState');

    let allGems = [];

    async function fetchGems() {
      try {
        const states = [
          "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat",
          "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh",
          "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab",
          "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh",
          "Uttarakhand", "West Bengal"
        ];

        let combined = [];

        for (const state of states) {
          const res = await fetch(`/api/hidden-gems/${state}`);
          if (res.ok) {
            const gems = await res.json();
            combined.push(...gems);
          }
        }

        allGems = combined;
        renderGems(combined);
      } catch (err) {
        gemsList.innerHTML = "‚ùå Error loading gems.";
        console.error(err);
      }
    }

    function renderGems(gems) {
      if (gems.length === 0) {
        gemsList.innerHTML = "‚ö†Ô∏è No gems found.";
        return;
      }

      gemsList.innerHTML = "";
      gems.forEach(gem => {
        const div = document.createElement("div");
        div.classList.add("gem");
        div.innerHTML = `
          <h3>${gem.name} (${gem.state})</h3>
          <p>${gem.description}</p>
          ${gem.image_url ? `<p><img src="${gem.image_url}" width="100" alt="gem image" /></p>` : ""}
          <small>Submitted by: ${gem.submitted_by}</small>
        `;
        gemsList.appendChild(div);
      });
    }

    filterInput.addEventListener("input", () => {
      const keyword = filterInput.value.trim().toLowerCase();
      const filtered = allGems.filter(g => g.state.toLowerCase().includes(keyword));
      renderGems(filtered);
    });

    fetchGems();
  </script>
</body>
</html>
